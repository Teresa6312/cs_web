{% extends "main/base_site.html" %}
{% load i18n static %}
{% load mathfilters %}

{% block title%}
{% trans 'Payment Process' %}
{% endblock%}

{% block content %}
<div style="width:60%; margin:auto;">
    <h4 class="w3-center aside-bar-background-color">{% trans 'Packages' %}</h4>
    <table class="w3-mobile">
        <tbody>
      {% if orderSet.service_set.all %}
          {% for package in orderSet.service_set.all %}
              <tr class="w3-cell-row"><td class="w3-cell w3-rest">
                <div class="w3-card-2 w3-round w3-panel package">
                      <div class="w3-third w3-container">
                        <h5 class="cust_tracking_num">{{package.cust_tracking_num}}</h5>

                          {{package.cust_carrier}} ({{package.wh_received.country}})<br/>
                          {% if package.created_date %}
                          {% trans 'Created on' %}: {{package.created_date|date:"M d, Y" }}<br/>{% endif %}
                          {% if package.weight %}
                            {{package.weight}}(KG)<br/>{% endif %}
                    </div>
                  <div class="w3-third w3-container">

                    {% if package.ship_to_add %}
                    <h5>{% trans 'Direct Shipping to' %}:</h5>

                          {{package.ship_to_add.last_name}}, {{package.ship_to_add.first_name}}<br/>
                            {{package.ship_to_add.address}}<br/>
                            {% if package.ship_to_add.apt %}{{package.ship_to_add.apt}}<br/>{% endif %}
                            {{package.ship_to_add.city}}, {{package.ship_to_add.state}} {{package.ship_to_add.zipcode}}<br/>
                            {{package.ship_to_add.country}}<br/>



                    {% elif package.ship_to_col %}
                    <h5>{% trans 'Co-shipping to' %}:</h5>
                          {{package.ship_to_col.name}}<br/>
                              {{package.ship_to_col.address}}<br/>
                              {% if package.ship_to_col.apt %}{{package.ship_to_col.apt}}<br/>{% endif %}
                              {{package.ship_to_col.city}}, {{package.ship_to_col.state}} {{package.ship_to_col.zipcode}}<br/>
                              {{package.ship_to_col.country}}<br/>

                    {% endif %}

                  </div>

                  <div class="w3-third w3-container">
                        <h5>Price:</h5>
                        {% if package.order_amount %}
                          {% trans 'Order Amount' %}: {{package.currency}} <span id="order_amount_{{ forloop.counter0 }}" class="order_amount">{{package.order_amount}}</span><br/>
                        {% endif %}
                        {% if package.storage_fee %}
                          {% trans 'Storage fee' %}: {{package.currency}} <span id="storage_fee_{{ forloop.counter0 }}" class="storage_fee">{{package.storage_fee}}</span><br/>
                        {% endif %}
                        {% if package.shipping_fee %}
                          {% trans 'Shipping fee' %}: {{package.currency}} <span id="shipping_fee_{{ forloop.counter0 }}" class="shipping_fee">{{package.shipping_fee}}</span><br/>
                        {% endif %}
                        {% trans 'Total Amount' %}: {{package.currency}} <span id="total_amount_{{ forloop.counter0 }}" class="total_amount"></span><br/>

                  {% if package.issue %}<div class="errornote">{% trans 'There are some issue with your packages. Please check package detail.' %}</div>{% endif %}
                  <button type="button" class="w3-right" onclick="window.open('{{package.get_absolute_url}}')">detail</button>
                  </div>
                  </div>
              </td></tr>
          {% endfor %}
      {% endif %}
      <tbody>
    </table>


      <div class="w3-panel w3-right">
        {% if orderSet.coupon %}
          <h5 id="discount_block">{{orderSet.coupon.code}}(5% OFF):<span class="w3-right" id="discount_amount">
            - {{orderSet.currency}}{{orderSet.coupon.discount|div:100|mul:orderSet.total_amount|floatformat:"2"}}
          </span></h5>
        {% endif %}
        {% if orderSet.reward_point_used > 0 %}
          <h5 id="reward_used_block">{{orderSet.reward_point_used}} points:<span class="w3-right" id="reward_discount_amount">
            - {{orderSet.currency}}{{orderSet.reward_point_used|div:100|floatformat:"2"}}
          </span></h5>
        {% endif %}
        <hr class="w3-border-black"/>
        <div id="amount_block">{% trans 'Total Amount' %}:<span class="w3-right" id="id_total_amount">
          {{orderSet.currency}}
          {% if orderSet.coupon %}
            {{100|sub:orderSet.coupon.discount|div:100|mul:orderSet.total_amount|floatformat:"2"}}
          {% else %}
            {{orderSet.total_amount|mul:100|sub:orderSet.reward_point_used|div:100|floatformat:"2"}}
          {% endif %}
        </span></div>
        <br/>
      {{form.render}}
      </div>
</div>
<script src="{% static 'js/package_cart.js' %}"></script>
<script>
$(document).ready(function(){
  $('input[type=image]').prop('src','https://www.paypalobjects.com/en_US/i/btn/btn_paynowCC_LG.gif');
  $('input[type=image]').prop('alt','Pay it now');
});
</script>
{% endblock %}
