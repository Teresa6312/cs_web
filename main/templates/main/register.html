{% extends "main/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "admin/css/login.css" %}" />
{{ form.media }}
    <link rel="stylesheet" href="{% static 'css/multistepform.css'%}"/>
{% endblock %}

{% block bodyclass %}{{ block.super }} login{% endblock %}

{% block usertools %}{% endblock %}

{% block branding %}{% endblock %}

{% block nav-global %}{% endblock %}

{% block content_title %}{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block footer %}{% endblock %}

{% block content %}
{% if form.errors and not form.non_field_errors %}
<p class="errornote">
{% if form.errors.items|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}
</p>
{% endif %}

{% if form.non_field_errors %}
{% for error in form.non_field_errors %}
<p class="errornote">
    {{ error }}
</p>
{% endfor %}
{% endif %}

<div id="content-main" class="w3-container">
    <div class="w3-panel w3-center">
    <img src="{%static 'image/logo.png'%}" width="100" height="100">
    </div>

    {% if user.is_authenticated %}
    <p class="errornote">
        You are authenticated as {{ user.username }}, but are not authorized to
        access this page. Would you like to login to a different account?
    </p>
    {% else %}

      {% if messages %}
      <ul class="messagelist">
          {% for message in messages %}
          <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|capfirst }}</li>
          {% endfor %}
      </ul>
      {% endif %}

      {% if form.errors %}
      <ul class="messagelist">
          {% for message in form.errors %}
          <li class="error" {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|capfirst }}</li>
          {% endfor %}
      </ul>
      {% endif %}

      {% if webformset.errors %}
      <ul class="messagelist">
          {% for subForm in webformset %}
          {% if subForm.errors %}
            {% for message in subForm.errors %}
            <li class="error asd" {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|capfirst }}</li>
            {% endfor %}
          {% endif %}
          {% endfor %}
      </ul>
      {% endif %}

      {% if profileform.errors %}
      <ul class="messagelist">
          {% for message in profileform.errors%}
          <li class="error" {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message|capfirst }}</li>
          {% endfor %}
      </ul>
      {% endif %}

          <form id="regForm" method="post">
    	    {% csrf_token %}
          <h3>Create My Qycs Account</h3>

          <!-- One "tab" for each step in the form: -->
          <div class="tab">
            Username: {{form.username}}
            Password: {{form.password1}}
            Confirm Password:{{form.password2}}
            Country:{{profileform.country}}
            Email:{{form.email}}
          </div>

          <div class="tab WebFormSet">
            <p>In order to provide the best service to you and other customers, please enter 3 of your favorite shopping websites below!</p>
            {{ webformset.management_form }}
            {% for subform in webformset%}
            <div class='w3-third select'>
              Website Type:
              {{subform.web_type}}
            </div>
            <div class='w3-rest'>
              Website Name:
              {{subform.web_name}}
            </div>
            {% endfor %}
          </div>

          <div class="tab">
              <div class='w3-row'>
                First name(optional):{{form.first_name}}
              </div>
              <div class='w3-row'>
                Last name(optional):{{form.last_name}}
              </div>
              <div class='w3-row'>
                Date of Birth(optional):<br/>{{profileform.birthday}}
              </div>
              <div class='w3-row'>
                Language(optional):{{profileform.language}}
              </div>
              <div class='w3-row'>
                Phone(optional):{{profileform.phone}}
              </div>
          </div>

          <div class="w3-row">
            <div style="float:right;">
              <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
              <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
              <span id="submit_block" style="display:none;">
                <button type = "submit" name="register" value ="Register">Register</button>
                <button type="submit" name="colregister" value="colregister" >Register as Collector</button>
              </span>
            </div>
          </div>


          <!-- Circles which indicates the steps of the form: -->
          <div class="w3-panel" style="text-align:center;">
            <span class="step"></span>
            <span class="step"></span>
            <span class="step"></span>
          </div>


      </form>




	{% endif %}
</div>
<script>
var currentTab = 0;

function showTab(n) {
  // This function will display the specified tab of the form ...
  var x = document.getElementsByClassName("tab");
  x[n].style.display = "block";

  //fix the Previous/Next buttons:
  if (n == 0) {
    document.getElementById("prevBtn").style.display = "none";
  } else {
    document.getElementById("prevBtn").style.display = "inline";
  }
  if (n == (x.length - 1)) {
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("submit_block").style.display = "inline";

  } else {
    document.getElementById("nextBtn").innerHTML = "Next";
    console.log(n)
  }
  //run a function that displays the correct step indicator:
  fixStepIndicator(n)
}

function nextPrev(n) {
  // This function will figure out which tab to display
  var x = document.getElementsByClassName("tab");
  // Exit the function if any field in the current tab is invalid:
  if (n == 1 && !validateForm()) return false;
  // Hide the current tab:
  x[currentTab].style.display = "none";
  // Increase or decrease the current tab by 1:
  currentTab = currentTab + n;
  // if you have reached the end of the form... :
  if (currentTab >= x.length) {
    //...the form gets submitted:
    document.getElementById("regForm").submit();
    return false;
  }
  // Otherwise, display the correct tab:
  showTab(currentTab);
}

function validateForm() {
  // This function deals with validation of the form fields
  var x, y, i,j, valid = true;
  x = document.getElementsByClassName("tab");
  y = x[currentTab].getElementsByTagName("input");
  // A loop that checks every input field in the current tab:
  // if(currentTab==0){
  //   p1 = document.getElementById("id_password1");
  //   p2 = document.getElementById("id_password2");
  //   if(p1!=p2){
  //     valid = false;
  //     if( $('#pw_err').length==0){
  //       var err = document.createElement("p");
  //       err.setAttribute("id", "pw_err");
  //       err.setAttribute("class", "errornote");
  //       err.innerHTML = "Passwords are not match!"
  //       $('#regForm').before(err);
  //     }
  //   }
  // }

if($('.WebFormSet').css('display')=="block"){
  let select=$('.select').each(function(){
    console.log($($(this)).find(":selected").text());
      if($($(this)).find(":selected").text()=="---"){
        valid=false;
        $(this).find('select').css('background-color','#ffdddd');
      }
  });
}




  for (i = 0; i < y.length; i++) {
    // If a field is empty...

    if (y[i].value == "") {
      // add an "invalid" class to the field:
      y[i].className += " invalid";
      // and set the current valid status to false:
      valid = false;
    }
  }
  // If the valid status is true, mark the step as finished and valid:
  if (valid) {
    document.getElementsByClassName("step")[currentTab].className += " finish";
  }
  return valid; // return the valid status
}

function fixStepIndicator(n) {
  // This function removes the "active" class of all steps...
  var i, x = document.getElementsByClassName("step");
  for (i = 0; i < x.length; i++) {
    x[i].className = x[i].className.replace(" active", "");
  }
  //... and adds the "active" class to the current step:
  x[n].className += " active";
}

$(document).ready(function(){

    showTab(currentTab);

    $(".cleanBtn").click(function(){
      $(this).closest('form').find("input[type=text], textarea").val("");
    });

	})


</script>
{% endblock%}
